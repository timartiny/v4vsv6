# No RD Bit

No RD Bit will perform `A` and `AAAA` record requests to each resolver for each
domain with the rd bit set to 0. It will then spit out responses:

It will take as input (via `--input`) a file containing lines of: 

```
domain.com,ip_address
```

Files fitting this format are generated by `07.sh` in
[scripts/zbuff](../../scripts/zbuff/07.sh) and the no-rd-bit
[script](../../scripts/zbuff/no-rd-bit/01.sh) uses those files directly if done as part of our working experiment.

If you're creating your own files to pass to this script IPv6 addresses need to
be enclosed in brackets, i.e., 

```
example.com,[2001::1]
```

The code might work without brackets around the IPv6 addresses, but because the
file we use as input already has them I've assumed they're there and explicitly
strip them.

Output looks like:

```
{"resolver":"201.140.112.174","domain":"v4vsv6.com","record":"A","r_code":0,"c_code":3,"explanation":"Resolver returned Additionals and/or Authorities"}
```

Formal usage:

```
Usage: no-rd-bit --input INPUT [--source-ip SOURCE-IP] [--threads THREADS] [--timeout TIMEOUT] --output OUTPUT

Options:
  --input INPUT          (Required) File to read "domain,ip" inputs from
  --source-ip SOURCE-IP
                         Address to send queries from [default: 192.12.240.40]
  --threads THREADS      Number of goroutines to use for queries [default: 1000]
  --timeout TIMEOUT      Number of seconds to wait for DNS and TLS connections [default: 5]
  --output OUTPUT        (Required) Path to the file to save results to
  --help, -h             display this help and exit
```

## Censorship Codes
Each response will get labelled with a `c_code` for the result of the record
requests the options are:

* Unknown = 0

This is the default setting whenever a record request is made, this should only
show up in unusual circumstances.

* ResolverResolveError = 1

The resolver gave a non-zero `r_code`, meaning it had an error it reported to
us, you can see the `r_code` in the response

* ResolverDialError = 2

The no-rd-bit script failed to Dial the address to create a UDP socket, this
error might be on our end?

* ResolverReadError = 3

The Resolver didn't respond during the provided Timeout Window.

* ReturnedAdditionals = 4

The Resolver returned only Additionals (NSes) and Authorities, no Answers

* ReturnedInvalidRecord = 5

The Resolver returned at least one Answer, but when we followed up with a TLS
connection we did not get a valid TLS cert back from any Answer
    
* ReturnedValidRecord = 6

The Resolver returned at least one Answer, and when we followed up at least one
of the IPs returned a valid TLS certificate
